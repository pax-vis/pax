<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <title>PA-X Timeline</title>
    <link rel="stylesheet" type="text/css" href="style1.css">
    <script type="text/javascript" src="d3.v4.js"></script>
    <style>

    g.polygons path {
      fill: white;
      stroke: lightsteelblue;
    }

    /* g.polygons path:hover {
      fill: yellow;
    } */

    g.fuel circle {
      fill: steelblue;
    }

    </style>
  </head>
  <body>
    <!--reference to D3 script must be in body tags-->
    <script type="text/javascript">

    d3.select(window).on("resize");
    callFunction();
    function callFunction() {

      function dragged() {
        d3.select(this).attr("transform","translate("+d3.event.x+","+d3.event.y+")"); // drags entire chart
      }
          //console.log(window.innerWidth); // not all browsers recorgnise window.innerWidth

          var tooltip = d3.select("body").append("div").style("opacity","0").style("position","absolute");

          var svgtest = d3.select("body").select("svg");
    			if (!svgtest.empty()) {
    				svgtest.remove();
    			}

          var width = window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth; //950;
          var height = window.innerHeight||document.documentElement.clientHeight||document.body.clientWidth; //500;


          var vertices = d3.range(100).map(function(d){ return[Math.random()*width,Math.random()*height]; });

            var voronoi = d3.voronoi().size([width,height]);
            var svg = d3.select("body").append("svg").attr("width","100%").attr("height","100%");
            var chartGroup = svg.append("g").call(d3.drag().on("drag",dragged));

            chartGroup.call(d3.zoom()
              .scaleExtent([0.8,2]) //to limit zooming
              .on("zoom",function(){  //on: tell event, then tell function
                chartGroup.attr("transform",d3.event.transform);
            }));

            chartGroup.append("g").attr("class","polygons")
            .selectAll("path")
              .data(voronoi.polygons(vertices))
              .enter().append("path")
                         .attr("d",function(d){ return "M"+d.join("L")+"Z" })
                         .on("mousemove",function(d){
                           //this.style.fill = "lightsteelblue"
                           tooltip.style("opacity","1")
                             .style("left",d[0][0]+"px") //.style("left",d3.event.pageX+"px")
                             .style("top",d[0][1]+"px");//.style("top",d3.event.pageY+"px");
                           //console.log(d3.event);
                           tooltip.html("Numer of sides: "+d.length);

                         })
                         //.on("mouseout",function() {this.style.fill = "white"; });

                         //.on("mousemove",function(){ this.style.fill = "red"; })
                         //.on("mouseout",function(){ this.style.fill = "white"; }); //return to original color when not hovering

            chartGroup.append("g").attr("class","fuel")
            .selectAll("circle")
              .data(vertices)
              .enter().append("circle")
                        .attr("cx",function(d){return d[0]; })
                        .attr("cy",function(d){return d[1]; })
                        .attr("r","2.5");

            d3.select("g.polygons").select("path:nth-child(30)")
              .transition().duration(1000).delay(1000)
              .style("fill","red")
              .transition().duration(1000).delay(1000)
              .style("fill","blue")
              .attr("transform","translate(10,10)");
            d3.select("g.polygons").select("path:nth-child(30)").dispatch("mousemove");

      }

    </script>
  </body>

</html>
